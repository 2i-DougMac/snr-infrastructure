# snr-infrastructure:
A small express application with one webpage.
Designed to be deployed as a Docker container on AWS Fargate via Terraform.

# You will require local machine installations of:
Git
Node.js
Docker
Terraform
AWS CLI

# NB:
 It is assumed for the purposes of these instructions that you have set up an AWS account and created AWS IAM user with AdministratorAccess permissions and configured their credentials as envrironment variables or similar for use via the AWS CLI. Instructions on all of this are not included here.

# Running locally
npm i
node src/server.js

# Running in Docker
docker build -t my-lovely-horse .
docker run -d -p 3000:3000 my-lovely-horse

# Running on AWS - Provisioning
terraform init
terraform plan
terraform apply & confirm apply

The resources will be provisioned. It is possible that the load balancer will take several minutes.

# Running on AWS - Pushing to ECR
After provisioning is complete, navigate to the my-lovely-horse repository in your ECR. Click the orange button that says "view push commands". This will give you a set of four terminal commands to run from the working directory that will build and tag the image and upload it to the repository.

If you are running Apple Silicon, append the build command with --platform linux/amd64 because the Docker builds will be Arm by default.

# Running on AWS - Access the app
After the image has been pushed, wait a moment and the app will be live at the URL generated by the terraform apply command.
